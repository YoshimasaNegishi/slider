<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>å…¨å¹…ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆä¸ŠåŠåˆ†è¡¨ç¤ºï¼‰</title>

<style>
    /* ========================================
       CSSå¤‰æ•°ï¼ˆè¨­å®šå€¤ã®ä¸€å…ƒç®¡ç†ï¼‰
       ======================================== */
    :root {
        --slider-width: 4px;           /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒãƒ¼ã®å¹… */
        --slider-handle-size: 44px;    /* ä¸¸ãƒãƒ³ãƒ‰ãƒ«ã®ã‚µã‚¤ã‚º */
        --slider-initial-pos: 50%;     /* åˆæœŸä½ç½® */
        --aspect-ratio-padding: 40%;   /* ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ï¼ˆé«˜ã•/å¹…ï¼‰*/
        --slider-color: #fff;          /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®è‰² */
        --bg-color: #111;              /* èƒŒæ™¯è‰² */
    }

    body {
        margin: 0;
        background: var(--bg-color);
        font-family: sans-serif;
    }

    /* â˜… ãƒ–ãƒ©ã‚¦ã‚¶å¹…ã„ã£ã±ã„è¡¨ç¤º */
    .comparison-container {
        width: 100vw;
        max-width: 100vw;
        margin: 0 calc(50% - 50vw);
        overflow: hidden;
        position: relative;
    }

    /* â˜… è¡¨ç¤ºé«˜ã•æ±ºã‚
       padding-bottomãƒãƒƒã‚¯: å¹…ã«å¯¾ã™ã‚‹æ¯”ç‡ã§é«˜ã•ã‚’ç¢ºä¿
       ä¾‹: 40% = é«˜ã•ãŒå¹…ã®40%ï¼ˆ5:2ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ï¼‰*/
    .image-wrapper {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: var(--aspect-ratio-padding);
    }

    .image-before,
    .image-after {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;

        /* ä¸ŠåŠåˆ†å„ªå…ˆè¡¨ç¤º */
        object-fit: cover;
        object-position: top center;

        /* é¸æŠç¦æ­¢ */
        user-select: none;
        -webkit-user-drag: none;
        pointer-events: none;

        /* GPUã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœ‰åŠ¹åŒ– */
        transform: translateZ(0);
        backface-visibility: hidden;
        will-change: clip-path;
    }

    .image-after {
        clip-path: inset(0 0 0 var(--slider-initial-pos));
    }

    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æœ¬ä½“ */
    .slider {
        position: absolute;
        top: 0;
        left: var(--slider-initial-pos);
        width: var(--slider-width);
        height: 100%;
        background: var(--slider-color);
        cursor: ew-resize;
        transform: translateX(-50%);
        z-index: 10;
        will-change: left;
    }

    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ä¸¸ãƒãƒ³ãƒ‰ãƒ« */
    .slider::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: var(--slider-handle-size);
        height: var(--slider-handle-size);
        border-radius: 50%;
        background: var(--slider-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰ */
    .slider:focus {
        outline: none;
    }
    .slider:focus-visible::before {
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.6), 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    /* ========================================
       ã‚¹ãƒãƒ›ç¸¦å‘ãå¯¾å¿œ
       ã‚µã‚¤ãƒ‰ã‚¦ã‚©ãƒ¼ãƒ«ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å¤§ããè¡¨ç¤º
       ======================================== */
    @media (orientation: portrait) and (max-width: 768px) {
        :root {
            --aspect-ratio-padding: 75%;  /* ç¸¦å‘ãã¯é«˜ã•ã‚’æ‹¡å¤§ */
        }

        .image-before,
        .image-after {
            /* ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ã—ã¦ã‚µã‚¤ãƒ‰ã‚¦ã‚©ãƒ¼ãƒ«ã‚’å¼·èª¿ */
            transform: scale(1.3) translateZ(0);
            transform-origin: top center;
        }
    }

    /* ========================================
       ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ»æ¨ªå‘ããƒœã‚¿ãƒ³
       ======================================== */
    .fullscreen-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
        border: none;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s, background 0.2s;
    }

    .fullscreen-btn:hover {
        transform: scale(1.1);
        background: #fff;
    }

    .fullscreen-btn:active {
        transform: scale(0.95);
    }

    /* æ¨ªå‘ãã‚„PCã§ã¯éè¡¨ç¤º */
    @media (orientation: landscape), (min-width: 769px) {
        .fullscreen-btn {
            display: none;
        }
    }

    /* ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .comparison-container:fullscreen,
    .comparison-container:-webkit-full-screen {
        background: var(--bg-color);
        display: flex;
        align-items: center;
    }

    .comparison-container:fullscreen .image-wrapper,
    .comparison-container:-webkit-full-screen .image-wrapper {
        padding-bottom: 40%;  /* ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ™‚ã¯æ¨™æº–æ¯”ç‡ */
    }

    .comparison-container:fullscreen .image-before,
    .comparison-container:fullscreen .image-after,
    .comparison-container:-webkit-full-screen .image-before,
    .comparison-container:-webkit-full-screen .image-after {
        transform: translateZ(0);  /* ã‚ºãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ */
    }

    /* å›è»¢ã‚¬ã‚¤ãƒ‰ï¼ˆiOSç”¨ï¼‰ */
    .rotate-guide {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 200;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #fff;
    }

    .rotate-guide.show {
        display: flex;
    }

    .rotate-guide-icon {
        font-size: 64px;
        margin-bottom: 20px;
        animation: rotate-hint 1.5s ease-in-out infinite;
    }

    .rotate-guide-text {
        font-size: 18px;
        text-align: center;
        padding: 0 40px;
    }

    .rotate-guide-close {
        margin-top: 30px;
        padding: 12px 32px;
        border: 2px solid #fff;
        border-radius: 25px;
        background: transparent;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
    }

    @keyframes rotate-hint {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(90deg); }
    }
</style>
</head>
<body>

<div class="comparison-container" id="comparison" role="group" aria-label="ç”»åƒæ¯”è¼ƒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼">
    <div class="image-wrapper">
        <img class="image-before" id="img-before" src="before.jpg" alt="å¤‰æ›´å‰ã®ç”»åƒ" />
        <img class="image-after" id="img-after" src="after.jpg" alt="å¤‰æ›´å¾Œã®ç”»åƒ" />
        <div class="slider"
             id="slider"
             role="slider"
             tabindex="0"
             aria-label="æ¯”è¼ƒä½ç½®"
             aria-valuemin="0"
             aria-valuemax="100"
             aria-valuenow="50"
             aria-valuetext="50%"></div>
    </div>
</div>

<!-- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ»æ¨ªå‘ããƒœã‚¿ãƒ³ï¼ˆç¸¦å‘ãã‚¹ãƒãƒ›ã®ã¿è¡¨ç¤ºï¼‰ -->
<button class="fullscreen-btn" id="fullscreen-btn" aria-label="æ¨ªå‘ããƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§è¡¨ç¤º">
    â¤¢
</button>

<!-- å›è»¢ã‚¬ã‚¤ãƒ‰ï¼ˆiOSç”¨ï¼‰ -->
<div class="rotate-guide" id="rotate-guide">
    <div class="rotate-guide-icon">ğŸ“±</div>
    <div class="rotate-guide-text">
        æ¨ªå‘ãã«å›è»¢ã™ã‚‹ã¨<br>å¤§ããè¡¨ç¤ºã•ã‚Œã¾ã™
    </div>
    <button class="rotate-guide-close" id="rotate-guide-close">é–‰ã˜ã‚‹</button>
</div>

<script>
/**
 * ç”»åƒæ¯”è¼ƒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 * IIFEã§ã‚¹ã‚³ãƒ¼ãƒ—ã‚’éš”é›¢ã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“ã‚’é˜²æ­¢
 */
(function() {
    'use strict';

    /* ========================================
       è¨­å®šå€¤
       ======================================== */
    const CONFIG = {
        INITIAL_POSITION: 50,    // åˆæœŸä½ç½®ï¼ˆ%ï¼‰
        MIN_POSITION: 0,         // æœ€å°ä½ç½®ï¼ˆ%ï¼‰
        MAX_POSITION: 100,       // æœ€å¤§ä½ç½®ï¼ˆ%ï¼‰
        KEYBOARD_STEP: 1,        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œæ™‚ã®ç§»å‹•é‡ï¼ˆ%ï¼‰
        KEYBOARD_STEP_LARGE: 10  // Shift+çŸ¢å°ã‚­ãƒ¼ã§ã®ç§»å‹•é‡ï¼ˆ%ï¼‰
    };

    /* ========================================
       çŠ¶æ…‹ç®¡ç†
       ======================================== */
    const state = {
        isDragging: false,
        currentPosition: CONFIG.INITIAL_POSITION,
        containerRect: null,      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸåº§æ¨™
        rafId: null               // requestAnimationFrame ID
    };

    /* ========================================
       DOMè¦ç´ ã®å–å¾—ã¨æ¤œè¨¼
       ======================================== */
    const elements = {
        comparison: document.getElementById('comparison'),
        slider: document.getElementById('slider'),
        imgAfter: document.getElementById('img-after'),
        imgBefore: document.getElementById('img-before')
    };

    /**
     * å¿…é ˆDOMè¦ç´ ã®å­˜åœ¨ã‚’æ¤œè¨¼
     * @returns {boolean} ã™ã¹ã¦ã®è¦ç´ ãŒå­˜åœ¨ã™ã‚Œã°true
     */
    function validateElements() {
        const missing = Object.entries(elements)
            .filter(([, el]) => !el)
            .map(([name]) => name);

        if (missing.length > 0) {
            console.error('[Slider] å¿…é ˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', missing.join(', '));
            return false;
        }
        return true;
    }

    /* ========================================
       åº§æ¨™ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
       ======================================== */
    /**
     * ã‚³ãƒ³ãƒ†ãƒŠã®åº§æ¨™ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
     * ãƒªã‚µã‚¤ã‚ºæ™‚ã«å†è¨ˆç®—ã•ã‚Œã‚‹
     */
    function updateContainerRect() {
        state.containerRect = elements.comparison.getBoundingClientRect();
    }

    /* ========================================
       ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ›´æ–°å‡¦ç†
       ======================================== */
    /**
     * ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä½ç½®ã‚’æ›´æ–°
     * @param {number} percentage - ä½ç½®ï¼ˆ0-100%ï¼‰
     */
    function setSliderPosition(percentage) {
        // ç¯„å›²ã‚’åˆ¶é™ï¼ˆ0-100%ï¼‰
        percentage = Math.max(CONFIG.MIN_POSITION, Math.min(CONFIG.MAX_POSITION, percentage));
        state.currentPosition = percentage;

        // DOMæ›´æ–°
        elements.slider.style.left = percentage + '%';
        elements.imgAfter.style.clipPath = `inset(0 0 0 ${percentage}%)`;

        // ARIAå±æ€§ã‚’æ›´æ–°ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
        elements.slider.setAttribute('aria-valuenow', Math.round(percentage));
        elements.slider.setAttribute('aria-valuetext', Math.round(percentage) + '%');
    }

    /**
     * Xåº§æ¨™ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä½ç½®ã‚’è¨ˆç®—ã—ã¦æ›´æ–°
     * @param {number} clientX - ãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒã®Xåº§æ¨™
     */
    function updateSliderFromX(clientX) {
        if (!state.containerRect || state.containerRect.width === 0) {
            updateContainerRect();
        }

        // ã‚¼ãƒ­é™¤ç®—é˜²æ­¢
        if (state.containerRect.width === 0) return;

        const offsetX = clientX - state.containerRect.left;
        const percentage = (offsetX / state.containerRect.width) * 100;
        setSliderPosition(percentage);
    }

    /**
     * requestAnimationFrameã§ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ã•ã‚ŒãŸæ›´æ–°
     * @param {number} clientX - ãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒã®Xåº§æ¨™
     */
    function throttledUpdate(clientX) {
        if (state.rafId) {
            cancelAnimationFrame(state.rafId);
        }
        state.rafId = requestAnimationFrame(() => {
            updateSliderFromX(clientX);
            state.rafId = null;
        });
    }

    /* ========================================
       ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
       ======================================== */
    /**
     * ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
     * @param {Event} e - ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
     */
    function handleDragStart(e) {
        state.isDragging = true;
        updateContainerRect(); // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã«åº§æ¨™ã‚’æ›´æ–°
        e.preventDefault();
    }

    /**
     * ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
     */
    function handleDragEnd() {
        state.isDragging = false;
        if (state.rafId) {
            cancelAnimationFrame(state.rafId);
            state.rafId = null;
        }
    }

    /**
     * ãƒã‚¦ã‚¹ç§»å‹•
     * @param {MouseEvent} e - ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
     */
    function handleMouseMove(e) {
        if (state.isDragging) {
            throttledUpdate(e.clientX);
        }
    }

    /**
     * ã‚¿ãƒƒãƒç§»å‹•
     * @param {TouchEvent} e - ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
     */
    function handleTouchMove(e) {
        if (state.isDragging && e.touches.length > 0) {
            e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
            throttledUpdate(e.touches[0].clientX);
        }
    }

    /**
     * ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
     * @param {KeyboardEvent} e - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
     */
    function handleKeyDown(e) {
        const step = e.shiftKey ? CONFIG.KEYBOARD_STEP_LARGE : CONFIG.KEYBOARD_STEP;
        let newPosition = state.currentPosition;

        switch (e.key) {
            case 'ArrowLeft':
            case 'Left':
                newPosition -= step;
                break;
            case 'ArrowRight':
            case 'Right':
                newPosition += step;
                break;
            case 'Home':
                newPosition = CONFIG.MIN_POSITION;
                break;
            case 'End':
                newPosition = CONFIG.MAX_POSITION;
                break;
            default:
                return; // ä»–ã®ã‚­ãƒ¼ã¯ç„¡è¦–
        }

        e.preventDefault();
        setSliderPosition(newPosition);
    }

    /* ========================================
       ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
       ======================================== */
    /**
     * ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
     * @param {string} imageName - ç”»åƒã®è­˜åˆ¥å
     * @param {Event} e - ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
     */
    function handleImageError(imageName, e) {
        console.error(`[Slider] ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${imageName}`, e.target.src);
    }

    /* ========================================
       åˆæœŸåŒ–
       ======================================== */
    function initialize() {
        // DOMè¦ç´ ã®æ¤œè¨¼
        if (!validateElements()) {
            return;
        }

        // åˆæœŸåº§æ¨™ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        updateContainerRect();

        // ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        elements.imgBefore.addEventListener('error', (e) => handleImageError('before', e));
        elements.imgAfter.addEventListener('error', (e) => handleImageError('after', e));

        // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
        elements.slider.addEventListener('mousedown', handleDragStart);
        document.addEventListener('mouseup', handleDragEnd);
        document.addEventListener('mousemove', handleMouseMove);

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆï¼ˆpassive: falseã§preventDefaultã‚’æœ‰åŠ¹åŒ–ï¼‰
        elements.slider.addEventListener('touchstart', handleDragStart, { passive: false });
        document.addEventListener('touchend', handleDragEnd);
        document.addEventListener('touchmove', handleTouchMove, { passive: false });

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
        elements.slider.addEventListener('keydown', handleKeyDown);

        // ãƒªã‚µã‚¤ã‚ºæ™‚ã«åº§æ¨™ã‚’å†è¨ˆç®—
        window.addEventListener('resize', updateContainerRect);

        // åˆæœŸä½ç½®ã‚’è¨­å®š
        setSliderPosition(CONFIG.INITIAL_POSITION);
    }

    // DOMContentLoadedå¾Œã«åˆæœŸåŒ–
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
})();

/**
 * ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ»æ¨ªå‘ãæ©Ÿèƒ½
 */
(function() {
    'use strict';

    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const rotateGuide = document.getElementById('rotate-guide');
    const rotateGuideClose = document.getElementById('rotate-guide-close');
    const comparison = document.getElementById('comparison');

    if (!fullscreenBtn || !comparison) return;

    /**
     * iOSã‹ã©ã†ã‹ã‚’åˆ¤å®š
     */
    function isIOS() {
        return /iPad|iPhone|iPod/.test(navigator.userAgent) ||
               (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    }

    /**
     * Screen Orientation APIãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹
     */
    function canLockOrientation() {
        return screen.orientation && typeof screen.orientation.lock === 'function';
    }

    /**
     * ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³APIãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹
     */
    function canFullscreen() {
        return comparison.requestFullscreen ||
               comparison.webkitRequestFullscreen ||
               comparison.mozRequestFullScreen ||
               comparison.msRequestFullscreen;
    }

    /**
     * ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã«å…¥ã‚‹
     */
    async function enterFullscreen() {
        try {
            if (comparison.requestFullscreen) {
                await comparison.requestFullscreen();
            } else if (comparison.webkitRequestFullscreen) {
                await comparison.webkitRequestFullscreen();
            } else if (comparison.mozRequestFullScreen) {
                await comparison.mozRequestFullScreen();
            } else if (comparison.msRequestFullscreen) {
                await comparison.msRequestFullscreen();
            }
            return true;
        } catch (e) {
            console.warn('[Fullscreen] ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã«å…¥ã‚Œã¾ã›ã‚“ã§ã—ãŸ:', e);
            return false;
        }
    }

    /**
     * æ¨ªå‘ãã«ãƒ­ãƒƒã‚¯
     */
    async function lockLandscape() {
        if (!canLockOrientation()) return false;

        try {
            await screen.orientation.lock('landscape');
            return true;
        } catch (e) {
            console.warn('[Orientation] æ¨ªå‘ããƒ­ãƒƒã‚¯ã§ãã¾ã›ã‚“ã§ã—ãŸ:', e);
            return false;
        }
    }

    /**
     * ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
     */
    async function handleFullscreenClick() {
        // iOSã®å ´åˆï¼šå›è»¢ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º
        if (isIOS()) {
            rotateGuide.classList.add('show');
            return;
        }

        // Android/PCï¼šãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ + æ¨ªå‘ããƒ­ãƒƒã‚¯
        const fullscreenOk = await enterFullscreen();

        if (fullscreenOk) {
            await lockLandscape();
        }
    }

    /**
     * å›è»¢ã‚¬ã‚¤ãƒ‰ã‚’é–‰ã˜ã‚‹
     */
    function closeRotateGuide() {
        rotateGuide.classList.remove('show');
    }

    /**
     * æ¨ªå‘ãã«ãªã£ãŸã‚‰å›è»¢ã‚¬ã‚¤ãƒ‰ã‚’è‡ªå‹•ã§é–‰ã˜ã‚‹
     */
    function handleOrientationChange() {
        if (window.innerWidth > window.innerHeight) {
            closeRotateGuide();
        }
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    fullscreenBtn.addEventListener('click', handleFullscreenClick);

    if (rotateGuideClose) {
        rotateGuideClose.addEventListener('click', closeRotateGuide);
    }

    // å›è»¢æ¤œçŸ¥
    window.addEventListener('resize', handleOrientationChange);
    window.addEventListener('orientationchange', handleOrientationChange);

    // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³çµ‚äº†æ™‚ã«å‘ããƒ­ãƒƒã‚¯ã‚’è§£é™¤
    document.addEventListener('fullscreenchange', () => {
        if (!document.fullscreenElement && canLockOrientation()) {
            screen.orientation.unlock();
        }
    });
})();
</script>

</body>
</html>
